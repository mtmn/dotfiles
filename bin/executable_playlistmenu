#!/bin/bash
set -e

CHOICE_MAPPINGS=(
    "october:.october_25"
    "pink:pink"
    "ambient:ambient"
    "experimental:experimental"
    "club:club"
    "mud:mud"
    "weird:weird"
    "bass:bass"
    "140:140"
    "match:match"
    "sad:sad"
    "happy:happy"
    "screenshots:screenshots"
)

generate_choices() {
    printf '%s\n' "${CHOICE_MAPPINGS[@]}" | cut -d: -f1
}

get_playlist_mapping() {
    local choice="$1"
    
    for entry in "${CHOICE_MAPPINGS[@]}"; do
        if [ "${entry%:*}" = "$choice" ]; then
            echo "${entry#*:}"
            return 0
        fi
    done
    
    echo "$choice"
}

readonly CHOICES="$(generate_choices | tr '\n' '\n' | sed ':a;N;$!ba;s/\n/\\n/g')"

add_to_playlist() {
    local playlist_name="$1"
    
    if [ -z "$playlist_name" ]; then
        echo "Error: No playlist name provided" >&2
        exit 1
    fi
    
    add-to-playlist "$playlist_name"
}

handle_playlist_selection() {
    local chosen="$1"
    local playlist_name
    
    if [ -n "$chosen" ]; then
        playlist_name=$(get_playlist_mapping "$chosen")
        add_to_playlist "$playlist_name"
    else
        echo "Error: No playlist selected" >&2
        exit 1
    fi
}

main() {
    local chosen
    chosen=$(echo -e "$CHOICES" | dmenu "$@")
    
    handle_playlist_selection "$chosen"
}

main "$@"
