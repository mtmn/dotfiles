#!/bin/bash

timestamp=$(date +%s)
screenshot_file="$HOME/misc/screenshots/${timestamp}.png"

take_screenshot() {
    local temp_file="$1"
    
    if [ -n "$WAYLAND_DISPLAY" ]; then
        area=$(slurp 2>/dev/null) || return 1
        grim -g "$area" "$temp_file" || return 1
    else
        selection=$(hacksaw -f "-i %i -g %g" 2>/dev/null) || return 1
        shotgun "$selection" "$temp_file" || return 1
    fi
    
    return 0
}

copy_to_clipboard() {
    local file="$1"
    
    if [ -n "$WAYLAND_DISPLAY" ]; then
        wl-copy < "$file"
    else
        xclip -t 'image/png' -selection clipboard < "$file"
    fi
}

if take_screenshot "$screenshot_file"; then
    if [ -f "$screenshot_file" ] && [ -s "$screenshot_file" ]; then
        copy_to_clipboard "$screenshot_file"
    else
        rm -f "$screenshot_file"
        echo "no content captured" >&2
        exit 1
    fi
else
    echo "screenshot cancelled or failed"
    exit 1
fi
