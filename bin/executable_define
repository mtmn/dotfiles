#!/usr/bin/env bash

word=${1:-$(xclip -o -selection primary 2>/dev/null || wl-paste 2>/dev/null)}

# Check for empty word or special characters
[[ -z "$word" || "$word" =~ [\/] ]] && notify-send -t 3000 "define: Invalid input" && exit 0

# Check for connection error directly
encoded_word=$(printf %s "$word" | jq -sRr @uri)
if ! query=$(curl -s --connect-timeout 5 --max-time 10 "https://api.dictionaryapi.dev/api/v2/entries/en_US/$encoded_word"); then
	notify-send -t 3000 "define: Connection error" && exit 1
fi

# Check for invalid word response
[[ "$query" == *"\"title\":\"No Definitions Found\""* ]] && notify-send -t 3000 "define: Invalid word." && exit 0

# Show only first 3 definitions
def=$(echo "$query" | jq -r '[.[].meanings[] | {pos: .partOfSpeech, def: .definitions[].definition}] | .[:3].[] | "\n\(.pos). \(.def)"')

notify-send -t 60000 "$word -" "$def"
