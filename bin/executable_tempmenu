#!/bin/bash
set -e

generate_choices() {
    seq 6000 -500 1000 
    echo "off"
}

CHOICES="$(generate_choices | tr '\n' '\n' | sed ':a;N;$!ba;s/\n/\\n/g')"
readonly CHOICES

set_wayland_temperature() {
    case "$1" in
        off)
            pkill gammastep || true
            ;;
        [0-9]*)
            pkill gammastep || true
            gammastep -O "$1"
            ;;
        *)
            echo "Error: Invalid temperature value '$1'" >&2
            exit 1
            ;;
    esac
}

set_x11_temperature() {
    case "$1" in
        off)
            redshift -x
            ;;
        [0-9]*)
            redshift -O "$1"
            ;;
        *)
            echo "Error: Invalid temperature value '$1'" >&2
            exit 1
            ;;
    esac
}

main() {
    local chosen
    chosen=$(echo -e "$CHOICES" | dmenu "$@")
    
    if [ -n "$WAYLAND_DISPLAY" ]; then
        set_wayland_temperature "$chosen"
    else
        set_x11_temperature "$chosen"
    fi
}

main "$@"
