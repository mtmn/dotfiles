#!/bin/bash
set -euo pipefail

choices=$(echo "off"; seq 6000 -500 1000)
chosen=$(printf '%s\n' "$choices" | fuzzel --dmenu "$@")
[ -z "$chosen" ] && exit 0

if [ "$chosen" != "off" ] && ! [[ "$chosen" =~ ^[0-9]+$ ]]; then
    echo "Error: Invalid temperature '$chosen'" >&2
    exit 1
fi

if [ -n "${WAYLAND_DISPLAY:-}" ]; then
    pkill gammastep || true
    if [ "$chosen" != "off" ]; then
        gammastep -O "$chosen" &
    fi
else
    if [ "$chosen" = "off" ]; then
        redshift -x
    else
        redshift -O "$chosen"
    fi
fi
